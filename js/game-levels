// js/game-levels.js - Gesti贸n de niveles disponibles y no disponibles (ACTUALIZADO)

class GameLevelsManager {
    constructor() {
        this.availableLevels = ['whatsapp', 'email']; // WhatsApp y Email disponibles
        this.disabledLevels = ['calls', 'web', 'sms']; // Otros niveles no disponibles
        
        this.initializeLevels();
        this.setupEventListeners();
    }

    initializeLevels() {
        // Marcar niveles como deshabilitados
        this.disabledLevels.forEach(level => {
            const levelCard = document.querySelector(`.level-card button[onclick="startLevel('${level}')]`)
                                ?.closest('.level-card');
            if (levelCard) {
                levelCard.classList.add('disabled');
                
                // Reemplazar el bot贸n original
                const originalButton = levelCard.querySelector('.play-level-btn');
                if (originalButton) {
                    originalButton.onclick = () => this.showDemoWarning(level);
                }
                
                // Tambi茅n deshabilitar el icono de informaci贸n
                const infoIcon = levelCard.querySelector('.level-icon-corner');
                if (infoIcon) {
                    infoIcon.onclick = () => this.showDemoWarning(level);
                }
            }
        });

        // Habilitar el nivel de email (remover clase disabled si existe)
        const emailCard = document.querySelector('.level-card button[onclick="startLevel(\'email\')"]')?.closest('.level-card');
        if (emailCard) {
            emailCard.classList.remove('disabled');
        }
    }

    setupEventListeners() {
        // Cerrar modal al hacer clic fuera
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('demoWarningModal');
            if (e.target === modal) {
                this.closeDemoWarning();
            }
        });

        // Cerrar modal con ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.closeDemoWarning();
            }
        });
    }

    showDemoWarning(level) {
        const levelNames = {
            'calls': 'Llamadas Telef贸nicas', 
            'web': 'Navegaci贸n Web',
            'sms': 'Mensajes SMS'
        };

        const levelName = levelNames[level] || level;
        
        const modalHTML = `
            <div class="demo-modal-overlay" id="demoWarningModal">
                <div class="demo-modal-content">
                    <i class="bi bi-hourglass-split demo-modal-icon"></i>
                    <h2 class="demo-modal-title">隆CONTENIDO NO DISPONIBLE!</h2>
                    <p class="demo-modal-text">
                        El nivel <strong>${levelName}</strong> no est谩 disponible en la versi贸n demo del juego.
                    </p>
                    
                    <div class="demo-features-list">
                        <h4> EN CONSTRUCCIN </h4>
                        <ul>
                            <li> Escenarios realistas de ${levelName.toLowerCase()}</li>
                            <li> Mec谩nicas de juego 煤nicas</li>
                            <li> Sistema de puntuaci贸n avanzado</li>
                            <li> Retos y desaf铆os especiales</li>
                        </ul>
                    </div>

                    <p class="demo-modal-text">
                        <strong>隆Prueba nuestros niveles disponibles!</strong>
                    </p>

                    <div class="demo-modal-buttons">
                        <button class="whatsapp-available-btn" onclick="redirectToWhatsApp()">
                            <i class="bi bi-whatsapp"></i> WHATSAPP
                        </button>
                        <button class="email-available-btn" onclick="redirectToEmail()">
                            <i class="bi bi-envelope"></i> CORREO
                        </button>
                        <button class="demo-close-btn" onclick="gameLevelsManager.closeDemoWarning()">
                            <i class="bi bi-x-circle"></i> CERRAR
                        </button>
                    </div>
                </div>
            </div>
        `;

        // Remover modal existente si hay uno
        const existingModal = document.getElementById('demoWarningModal');
        if (existingModal) {
            existingModal.remove();
        }

        // Agregar nuevo modal
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        
        // Agregar estilos para el bot贸n de email
        const style = document.createElement('style');
        style.textContent = `
            .email-available-btn {
                background: linear-gradient(to right, #0078D4, #106EBE);
                color: white;
                border: none;
                padding: 12px 30px;
                border-radius: 25px;
                font-family: 'Monomaniac One', sans-serif;
                cursor: pointer;
                transition: all 0.3s ease;
                font-size: 1rem;
            }
            .email-available-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 120, 212, 0.4);
            }
            .demo-modal-buttons {
                display: flex;
                gap: 1rem;
                justify-content: center;
                flex-wrap: wrap;
            }
        `;
        document.head.appendChild(style);
        
        // Mostrar modal con animaci贸n
        setTimeout(() => {
            const modal = document.getElementById('demoWarningModal');
            modal.style.display = 'flex';
        }, 50);
    }

    closeDemoWarning() {
        const modal = document.getElementById('demoWarningModal');
        if (modal) {
            modal.style.animation = 'fadeOut 0.3s ease';
            setTimeout(() => {
                modal.remove();
            }, 250);
        }
    }

    // Verificar si un nivel est谩 disponible
    isLevelAvailable(level) {
        return this.availableLevels.includes(level);
    }
}

// Funci贸n global para redirigir a WhatsApp (nivel disponible)
function redirectToWhatsApp() {
    window.location.href = 'game-whatsapp.html';
}

// Funci贸n global para redirigir a Email (nivel disponible)
function redirectToEmail() {
    window.location.href = 'game-email.html';
}

// Funci贸n global startLevel modificada
function startLevel(level) {
    if (gameLevelsManager.isLevelAvailable(level)) {
        const gamePages = {
            'whatsapp': 'game-whatsapp.html',
            'email': 'game-email.html'
        };
        window.location.href = gamePages[level];
    } else {
        gameLevelsManager.showDemoWarning(level);
    }
}

// Inicializar el manager cuando se carga la p谩gina
let gameLevelsManager;

document.addEventListener('DOMContentLoaded', () => {
    gameLevelsManager = new GameLevelsManager();
});

// Agregar animaci贸n de fadeOut al CSS global
const style = document.createElement('style');
style.textContent = `
    @keyframes fadeOut {
        from { opacity: 1; }
        to { opacity: 0; }
    }
`;
document.head.appendChild(style);